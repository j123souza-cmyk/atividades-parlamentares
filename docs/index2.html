<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sessões do Plenário – Câmara</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f7f7f7;
}

h1 {
  margin-bottom: 10px;
}

.filtros {
  margin-bottom: 15px;
}

select, button {
  padding: 6px 10px;
  font-size: 14px;
  margin-right: 8px;
}

.contador {
  margin: 10px 0;
  font-weight: bold;
}

.sessao {
  background: #fff;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 6px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}

.carregando {
  font-style: italic;
}
</style>
</head>

<body>

<h1>Sessões Deliberativas do Plenário</h1>

<div class="filtros">
  <label>Período:</label>
  <select id="periodo">
    <option value="3" selected>Últimos 3 meses</option>
    <option value="6">Últimos 6 meses</option>
  </select>
  <button onclick="carregarSessoes()">Filtrar</button>
</div>

<div id="contador" class="contador"></div>

<div id="resultado">
  <div class="carregando">Carregando sessões...</div>
</div>

<script>
const BASE = "https://dadosabertos.camara.leg.br/api/v2";

function carregarSessoes() {
  const resultado = document.getElementById("resultado");
  const contador = document.getElementById("contador");
  const meses = Number(document.getElementById("periodo").value);

  resultado.innerHTML = '<div class="carregando">Carregando sessões...</div>';
  contador.textContent = "";

  const dataFim = new Date();
  const dataInicio = new Date();
  dataInicio.setMonth(dataFim.getMonth() - meses);

  const dataIniISO = dataInicio.toISOString().slice(0,10);
  const dataFimISO = dataFim.toISOString().slice(0,10);

  fetch(`${BASE}/eventos?codTipoEvento=140&dataInicio=${dataIniISO}&dataFim=${dataFimISO}&ordenarPor=dataHoraInicio&ordem=DESC&itens=100`)
    .then(r => r.json())
    .then(json => {
      const sessoes = json.dados || [];

      if (sessoes.length === 0) {
        resultado.innerHTML = "<p>Nenhuma sessão encontrada.</p>";
        contador.textContent = "Sessões encontradas: 0";
        return;
      }

      contador.textContent = `Sessões encontradas no período: ${sessoes.length}`;
      resultado.innerHTML = "";

      sessoes.forEach(sessao => {
        const inicio = sessao.dataHoraInicio
          ? new Date(sessao.dataHoraInicio).toLocaleString("pt-BR")
          : "Não informado";

        const div = document.createElement("div");
        div.className = "sessao";
        div.innerHTML = `
          <strong>${sessao.descricaoTipo || "Sessão Deliberativa"}</strong><br>
          <strong>Local:</strong> ${sessao.localCamara?.nome || "Plenário"}<br>
          <strong>Início:</strong> ${inicio}
        `;
        resultado.appendChild(div);
      });
    })
    .catch(erro => {
      console.error(erro);
      resultado.innerHTML = "<p>Erro ao carregar sessões.</p>";
    });
}

// carregar automaticamente ao abrir (3 meses)
carregarSessoes();
</script>

</body>
</html>
