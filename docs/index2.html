<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Votações em Plenário - Câmara dos Deputados</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<style>
body { font-family: Arial, sans-serif; margin: 16px; }
nav button { margin-right: 8px; padding: 8px 12px; cursor: pointer; }

.aba { display: none; }
.ativa { display: block; }

.evento {
  border-bottom: 1px solid #ddd;
  padding: 10px 0;
}

.evento strong { display: block; }
.info { font-size: 13px; color: #555; }
</style>
</head>
<body>

<h1>Votações em Plenário (Eventos)</h1>

<nav>
  <button onclick="mostrar('eventos')">Votações</button>
  <button onclick="mostrar('detalhe')">Deputado</button>
</nav>

<section id="eventos" class="aba ativa">
  <p id="statusEventos">Carregando votações em plenário…</p>
  <div id="listaEventos"></div>
</section>

<section id="detalhe" class="aba">
  <h2 id="nomeDeputado"></h2>
  <img id="fotoDeputado" width="120">
  <p><strong>Atividades no último ano</strong></p>
  <canvas id="grafico" width="420" height="300"></canvas>
</section>

<script>
const BASE = "https://dadosabertos.camara.leg.br/api/v2";
let chart = null;

function mostrar(id) {
  document.querySelectorAll('.aba').forEach(a => a.classList.remove('ativa'));
  document.getElementById(id).classList.add('ativa');
}

/* =========================
   VOTAÇÕES EM PLENÁRIO
========================= */
const statusEventos = document.getElementById("statusEventos");

fetch(`${BASE}/eventos?ordem=DESC&ordenarPor=dataHoraInicio&itens=100`)
  .then(r => r.json())
  .then(json => {
    statusEventos.innerText = "";

    const eventos = (json.dados || []).filter(e =>
      (e.descricao || "").toLowerCase().includes("votação") &&
      (e.descricao || "").toLowerCase().includes("plen")
    );

    if (eventos.length === 0) {
      statusEventos.innerText = "Nenhuma votação em plenário encontrada.";
      return;
    }

    eventos.forEach(ev => {
      const tema = extrairTema(ev.descricao);
      const resultado = extrairResultado(ev.descricao);

      const div = document.createElement("div");
      div.className = "evento";
      div.innerHTML = `
        <strong>${new Date(ev.dataHoraInicio).toLocaleString()}</strong>
        ${tema}<br>
        <span class="info">${resultado}</span>
      `;
      listaEventos.appendChild(div);
    });
  })
  .catch(() => {
    statusEventos.innerText = "Erro ao carregar eventos.";
  });

/* =========================
   EXTRAÇÃO DE TEXTO
========================= */
function extrairTema(txt) {
  if (!txt) return "";
  const partes = txt.split(".");
  return partes[0];
}

function extrairResultado(txt) {
  if (!txt) return "";
  const lower = txt.toLowerCase();
  if (lower.includes("aprov")) return "Resultado: Aprovado";
  if (lower.includes("rejeit")) return "Resultado: Rejeitado";
  if (lower.includes("retir")) return "Resultado: Retirado";
  return "Resultado: Deliberação registrada";
}

/* =========================
   DEPUTADOS (MANTIDO)
========================= */
function abrirDeputado(dep) {
  mostrar("detalhe");
  nomeDeputado.innerText = dep.nome;
  fotoDeputado.src = dep.urlFoto;
}

/* Gráfico mantido igual ao seu código funcional */
</script>

</body>
</html>
