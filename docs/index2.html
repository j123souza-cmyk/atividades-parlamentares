<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sess√µes do Plen√°rio ‚Äì C√¢mara</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f7f7f7;
}

h1 {
  margin-bottom: 10px;
}

.filtros {
  margin-bottom: 15px;
}

select {
  padding: 6px 10px;
  font-size: 14px;
}

.contador {
  margin: 10px 0;
  font-weight: bold;
}

.sessao {
  background: #fff;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 6px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}

.carregando {
  font-style: italic;
}
</style>
</head>

<body>

<h1>Sess√µes Deliberativas do Plen√°rio</h1>

<div class="filtros">
  <label>Per√≠odo:</label>
  <select id="periodo">
    <option value="3" selected>√öltimos 3 meses</option>
    <option value="6">√öltimos 6 meses</option>
  </select>
</div>

<div id="contador" class="contador"></div>

<div id="resultado">
  <div class="carregando">Carregando sess√µes...</div>
</div>

<script>
const BASE = "https://dadosabertos.camara.leg.br/api/v2";

function carregarSessoes() {
  const resultado = document.getElementById("resultado");
  const contador = document.getElementById("contador");
  const meses = Number(document.getElementById("periodo").value);

  resultado.innerHTML = '<div class="carregando">Carregando sess√µes...</div>';
  contador.textContent = "";

  const dataFim = new Date();
  const dataInicio = new Date();
  dataInicio.setMonth(dataFim.getMonth() - meses);

  const dataIniISO = dataInicio.toISOString().slice(0,10);
  const dataFimISO = dataFim.toISOString().slice(0,10);

  fetch(`${BASE}/eventos?codTipoEvento=140&dataInicio=${dataIniISO}&dataFim=${dataFimISO}&ordenarPor=dataHoraInicio&ordem=DESC&itens=100`)
    .then(r => r.json())
    .then(json => {
      const sessoes = json.dados || [];

      contador.textContent = `Sess√µes encontradas no per√≠odo: ${sessoes.length}`;

      if (sessoes.length === 0) {
        resultado.innerHTML = "<p>Nenhuma sess√£o encontrada.</p>";
        return;
      }

      resultado.innerHTML = "";

      sessoes.forEach(sessao => {
        const inicio = sessao.dataHoraInicio
          ? new Date(sessao.dataHoraInicio).toLocaleString("pt-BR")
          : "N√£o informado";

        const div = document.createElement("div");
        div.className = "sessao";
        div.innerHTML = `
          <strong>${sessao.descricaoTipo || "Sess√£o Deliberativa"}</strong><br>
          <strong>Local:</strong> ${sessao.localCamara?.nome || "Plen√°rio"}<br>
          <strong>In√≠cio:</strong> ${inicio}
        `;
        resultado.appendChild(div);
      });
    })
    .catch(err => {
      console.error(err);
      resultado.innerHTML = "<p>Erro ao carregar sess√µes.</p>";
    });
}

// üîÅ recarrega automaticamente ao trocar o per√≠odo
document.getElementById("periodo").addEventListener("change", carregarSessoes);

// carrega ao abrir (3 meses)
carregarSessoes();
</script>

</body>
</html>
