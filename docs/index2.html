<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Últimas Votações – Câmara dos Deputados</title>

<style>
body { font-family: Arial, sans-serif; margin: 16px; }
.evento {
  border-bottom: 1px solid #ddd;
  padding: 10px 0;
}
.evento strong { display:block; }
.info { font-size: 13px; color: #555; }
.tag {
  display: inline-block;
  font-size: 12px;
  padding: 2px 6px;
  background: #e3f2fd;
  border-radius: 4px;
  margin-top: 4px;
}
</style>
</head>
<body>

<h1>Últimas Votações em Plenário</h1>

<p id="status">Carregando sessões deliberativas…</p>
<div id="lista"></div>

<script>
const BASE = "https://dadosabertos.camara.leg.br/api/v2";
const status = document.getElementById("status");
const lista = document.getElementById("lista");

fetch(`${BASE}/eventos?ordem=DESC&ordenarPor=dataHoraInicio&itens=200`)
  .then(r => r.json())
  .then(json => {
    status.innerText = "";

    const eventos = (json.dados || []).filter(ev => {
      const texto =
        ((ev.descricao || "") + " " + (ev.titulo || "")).toLowerCase();

      return (
        texto.includes("sessão") &&
        (texto.includes("deliberativa") || texto.includes("ordem do dia"))
      );
    });

    if (eventos.length === 0) {
      status.innerText = "Nenhuma votação encontrada.";
      return;
    }

    eventos.slice(0, 20).forEach(ev => {
      const div = document.createElement("div");
      div.className = "evento";
      div.innerHTML = `
        <strong>${new Date(ev.dataHoraInicio).toLocaleString()}</strong>
        ${extrairTema(ev.descricao || ev.titulo)}<br>
        <span class="info">${extrairResultado(ev.descricao)}</span><br>
        <span class="tag">Sessão deliberativa</span>
      `;
      lista.appendChild(div);
    });
  })
  .catch(err => {
    console.error(err);
    status.innerText = "Erro ao carregar eventos.";
  });

function extrairTema(txt) {
  if (!txt) return "Sessão deliberativa";
  return txt.split(".")[0];
}

function extrairResultado(txt) {
  if (!txt) return "Resultado: Registro de sessão";
  const t = txt.toLowerCase();
  if (t.includes("aprov")) return "Resultado: Aprovado";
  if (t.includes("rejeit")) return "Resultado: Rejeitado";
  if (t.includes("retir")) return "Resultado: Retirado";
  return "Resultado: Sessão deliberativa";
}
</script>

</body>
</html>
