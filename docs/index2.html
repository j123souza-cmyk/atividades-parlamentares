<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Últimas Votações – Câmara dos Deputados</title>

<style>
body { font-family: Arial, sans-serif; margin: 16px; }
.evento {
  border-bottom: 1px solid #ddd;
  padding: 10px 0;
}
.evento strong { display:block; }
.info { font-size: 13px; color: #555; }
</style>
</head>
<body>

<h1>Últimas Votações (Eventos Oficiais)</h1>

<p id="status">Carregando votações…</p>
<div id="lista"></div>

<script>
const BASE = "https://dadosabertos.camara.leg.br/api/v2";
const status = document.getElementById("status");
const lista = document.getElementById("lista");

fetch(`${BASE}/eventos?ordem=DESC&ordenarPor=dataHoraInicio&itens=150`)
  .then(r => r.json())
  .then(json => {
    status.innerText = "";

    const eventos = (json.dados || []).filter(e => {
      const d = (e.descricao || "").toLowerCase();
      return (
        d.includes("votaç") ||
        d.includes("ordem do dia") ||
        d.includes("delibera")
      );
    });

    if (eventos.length === 0) {
      status.innerText = "Nenhuma votação encontrada.";
      return;
    }

    eventos.slice(0, 20).forEach(ev => {
      const div = document.createElement("div");
      div.className = "evento";
      div.innerHTML = `
        <strong>${new Date(ev.dataHoraInicio).toLocaleString()}</strong>
        ${extrairTema(ev.descricao)}<br>
        <span class="info">${extrairResultado(ev.descricao)}</span>
      `;
      lista.appendChild(div);
    });
  })
  .catch(() => {
    status.innerText = "Erro ao carregar eventos.";
  });

function extrairTema(txt) {
  if (!txt) return "";
  return txt.split(".")[0];
}

function extrairResultado(txt) {
  const t = (txt || "").toLowerCase();
  if (t.includes("aprov")) return "Resultado: Aprovado";
  if (t.includes("rejeit")) return "Resultado: Rejeitado";
  if (t.includes("retir")) return "Resultado: Retirado";
  return "Resultado: Em deliberação";
}
</script>

</body>
</html>
