<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sess√µes Deliberativas do Plen√°rio</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f7f7f7;
}

h1 {
  margin-bottom: 10px;
}

.filtros {
  margin-bottom: 15px;
}

select {
  padding: 6px 10px;
  font-size: 14px;
}

.contador {
  margin: 10px 0;
  font-weight: bold;
}

.sessao {
  background: #fff;
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 6px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  cursor: pointer;
}

.sessao:hover {
  background: #eef3ff;
}

.detalhes {
  background: #fafafa;
  border-left: 4px solid #3f51b5;
  margin-top: 8px;
  padding: 10px;
  display: none;
  font-size: 14px;
}

.carregando {
  font-style: italic;
}
</style>
</head>

<body>

<h1>Sess√µes Deliberativas do Plen√°rio</h1>

<div class="filtros">
  <label>Per√≠odo:</label>
  <select id="periodo">
    <option value="3" selected>√öltimos 3 meses</option>
    <option value="6">√öltimos 6 meses</option>
  </select>
</div>

<div id="contador" class="contador"></div>

<div id="resultado">
  <div class="carregando">Carregando sess√µes...</div>
</div>

<script>
const BASE = "https://dadosabertos.camara.leg.br/api/v2";

function carregarSessoes() {
  const resultado = document.getElementById("resultado");
  const contador = document.getElementById("contador");
  const meses = Number(document.getElementById("periodo").value);

  resultado.innerHTML = '<div class="carregando">Carregando sess√µes...</div>';
  contador.textContent = "";

  const dataFim = new Date();
  const dataInicio = new Date();
  dataInicio.setMonth(dataFim.getMonth() - meses);

  const dataIni = dataInicio.toISOString().slice(0,10);
  const dataFimISO = dataFim.toISOString().slice(0,10);

  fetch(`${BASE}/eventos?dataInicio=${dataIni}&dataFim=${dataFimISO}&ordenarPor=dataHoraInicio&ordem=DESC&itens=150`)
    .then(r => r.json())
    .then(json => {

      // üõ°Ô∏è FILTRO REAL: s√≥ sess√µes deliberativas do plen√°rio
      const sessoes = (json.dados || []).filter(e =>
        (e.descricaoTipo || "").toLowerCase().includes("sess√£o") &&
        (e.descricao || "").toLowerCase().includes("vota√ß√£o")
      );

      contador.textContent = `Sess√µes encontradas no per√≠odo: ${sessoes.length}`;

      if (sessoes.length === 0) {
        resultado.innerHTML = "<p>Nenhuma sess√£o deliberativa encontrada.</p>";
        return;
      }

      resultado.innerHTML = "";

      sessoes.forEach(sessao => {
        const inicio = sessao.dataHoraInicio
          ? new Date(sessao.dataHoraInicio).toLocaleString("pt-BR")
          : "N√£o informado";

        const div = document.createElement("div");
        div.className = "sessao";

        div.innerHTML = `
          <strong>${sessao.descricaoTipo}</strong><br>
          <strong>In√≠cio:</strong> ${inicio}
          <div class="detalhes"></div>
        `;

        div.addEventListener("click", () => toggleDetalhes(div, sessao));
        resultado.appendChild(div);
      });
    })
    .catch(err => {
      console.error(err);
      resultado.innerHTML = "<p>Erro ao carregar sess√µes.</p>";
    });
}

function toggleDetalhes(div, sessao) {
  const detalhes = div.querySelector(".detalhes");

  if (detalhes.style.display === "block") {
    detalhes.style.display = "none";
    return;
  }

  detalhes.style.display = "block";
  detalhes.innerHTML = "<em>Carregando detalhes...</em>";

  const inicio = sessao.dataHoraInicio
    ? new Date(sessao.dataHoraInicio).toLocaleString("pt-BR")
    : "N√£o informado";

  detalhes.innerHTML = `
    <strong>Descri√ß√£o completa:</strong><br>
    ${sessao.descricao || "Descri√ß√£o n√£o dispon√≠vel"}<br><br>
    <strong>Local:</strong> ${sessao.localCamara?.nome || "Plen√°rio"}<br>
    <strong>In√≠cio:</strong> ${inicio}<br>
    <strong>√ìrg√£o:</strong> ${sessao.orgao?.nome || "C√¢mara dos Deputados"}
  `;
}

document.getElementById("periodo").addEventListener("change", carregarSessoes);
carregarSessoes();
</script>

</body>
</html>
