<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Atividades Parlamentares</title>

<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.deputado {
  display: flex;
  align-items: center;
  gap: 10px;
  border-bottom: 1px solid #ddd;
  padding: 10px 0;
}
.deputado img {
  width: 60px;
  border-radius: 6px;
}
</style>
</head>

<body>

<h1>Deputados Federais – Atividades</h1>
<p id="status">Carregando deputados…</p>

<div id="lista"></div>

<script>
const API = "https://dadosabertos.camara.leg.br/api/v2";
const LIMITE = 20;

async function iniciar() {
  try {
    const depResp = await fetch(`${API}/deputados?ordenarPor=nome&itens=${LIMITE}`);
    const depJson = await depResp.json();
    const deputados = depJson.dados;

    document.getElementById("status").remove();

    for (const d of deputados) {
      carregarDeputado(d);
    }

  } catch (e) {
    document.getElementById("status").innerText = "Erro ao carregar dados";
    console.error(e);
  }
}

async function carregarDeputado(dep) {
  const div = document.createElement("div");
  div.className = "deputado";
  div.innerHTML = `
    <img src="${dep.urlFoto}">
    <div>
      <strong>${dep.nome}</strong><br>
      ${dep.siglaPartido} - ${dep.siglaUf}<br>
      Carregando atividades…
    </div>
  `;

  document.getElementById("lista").appendChild(div);

  try {
    const evResp = await fetch(`${API}/deputados/${dep.id}/eventos?itens=50`);
    const evJson = await evResp.json();
    const total = evJson.dados ? evJson.dados.length : 0;

    div.querySelector("div").innerHTML = `
      <strong>${dep.nome}</strong><br>
      ${dep.siglaPartido} - ${dep.siglaUf}<br>
      ${total} eventos registrados
    `;
  } catch {
    div.querySelector("div").innerHTML += `<br>Erro ao carregar eventos`;
  }
}

iniciar();
</script>

</body>
</html>
