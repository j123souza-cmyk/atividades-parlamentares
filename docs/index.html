<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Atividades Parlamentares</title>

<style>
body { font-family: Arial, sans-serif; margin: 16px; }
nav button { margin-right: 8px; padding: 8px 12px; cursor: pointer; }
.aba { display: none; }
.ativa { display: block; }

.deputado {
  display: flex;
  gap: 10px;
  border-bottom: 1px solid #ddd;
  padding: 8px 0;
  cursor: pointer;
}
.deputado img { width: 60px; border-radius: 6px; }

details summary {
  cursor: pointer;
  font-weight: bold;
}
</style>
</head>

<body>

<h1>Atividades Parlamentares</h1>

<nav>
  <button onclick="mostrar('lista')">Deputados</button>
  <button onclick="mostrar('detalhe')">Detalhes</button>
</nav>

<section id="lista" class="aba ativa">
  <p id="status">Carregando deputados...</p>
  <div id="listaDeputados"></div>
</section>

<section id="detalhe" class="aba">
  <h2 id="nomeDeputado"></h2>
  <img id="fotoDeputado">
  <h3>ðŸ“„ ProposiÃ§Ãµes apresentadas</h3>
  <ul id="proposicoesApresentadas"></ul>

  <h3>ðŸ“‘ VotaÃ§Ãµes</h3>
  <ul id="proposicoesVotadas"></ul>
</section>

<script>
const BASE = "https://dadosabertos.camara.leg.br/api/v2";

const listaDeputadosEl = document.getElementById("listaDeputados");
const statusEl = document.getElementById("status");
const nomeDeputadoEl = document.getElementById("nomeDeputado");
const fotoDeputadoEl = document.getElementById("fotoDeputado");
const proposicoesApresentadasEl = document.getElementById("proposicoesApresentadas");
const proposicoesVotadasEl = document.getElementById("proposicoesVotadas");

function mostrar(id) {
  document.querySelectorAll('.aba').forEach(a => a.classList.remove('ativa'));
  document.getElementById(id).classList.add('ativa');
}

/* ===== CARREGAR DEPUTADOS ===== */
fetch(`${BASE}/deputados?ordem=ASC&ordenarPor=nome`)
  .then(r => r.json())
  .then(json => {
    statusEl.remove();
    json.dados.forEach(dep => {
      const div = document.createElement("div");
      div.className = "deputado";
      div.innerHTML = `
        <img src="${dep.urlFoto}">
        <div>
          <strong>${dep.nome}</strong><br>
          ${dep.siglaPartido} - ${dep.siglaUf}
        </div>
      `;
      div.onclick = () => abrirDetalhe(dep);
      listaDeputadosEl.appendChild(div);
    });
  })
  .catch(err => {
    statusEl.innerText = "Erro ao carregar deputados";
    console.error(err);
  });

/* ===== DETALHE ===== */
async function abrirDetalhe(dep) {
  mostrar("detalhe");
  nomeDeputadoEl.innerText = dep.nome;
  fotoDeputadoEl.src = dep.urlFoto;

  carregarProposicoes(dep.id);
  carregarVotacoes(dep.id);
}

/* ===== PROPOSIÃ‡Ã•ES ===== */
async function carregarProposicoes(id) {
  proposicoesApresentadasEl.innerHTML = "<li>Carregando...</li>";
  const r = await fetch(`${BASE}/proposicoes?autor=id:${id}&itens=10`);
  const dados = (await r.json()).dados || [];
  proposicoesApresentadasEl.innerHTML = "";
  dados.forEach(p => {
    proposicoesApresentadasEl.innerHTML += `
      <li>
        <details>
          <summary>${p.siglaTipo} ${p.numero}/${p.ano}</summary>
          <p>${p.ementa || "Sem ementa"}</p>
        </details>
      </li>`;
  });
}

/* ===== VOTAÃ‡Ã•ES ===== */
async function carregarVotacoes(id) {
  proposicoesVotadasEl.innerHTML = "<li>Carregando...</li>";
  const r = await fetch(`${BASE}/deputados/${id}/votacoes?itens=10`);
  const dados = (await r.json()).dados || [];
  proposicoesVotadasEl.innerHTML = "";
  dados.forEach(v => {
    proposicoesVotadasEl.innerHTML += `<li>${v.data} â€“ ${v.descricao}</li>`;
  });
}
</script>

</body>
</html>
