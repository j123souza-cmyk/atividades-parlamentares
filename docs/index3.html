<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Atua√ß√£o Parlamentar ‚Äî Jandira Feghali</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 20px; }
.container { max-width: 1100px; margin: auto; }
h1 { text-align: center; margin-bottom: 20px; }
.accordion { background: #fff; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 2px 6px rgba(0,0,0,.1); }
.accordion-header { padding: 15px; background: #8e0038; color: #fff; font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; }
.accordion-content { display: none; padding: 20px; }
.item { border-left: 5px solid #8e0038; padding-left: 12px; margin-bottom: 14px; }
.relevante { border-color: #d62828; background: #fff4f4; }
.label { font-weight: bold; }
.stats { background: #fdecef; padding: 12px; border-radius: 6px; margin-bottom: 15px; }
.small { font-size: 14px; color: #555; }
a { color: #8e0038; text-decoration: none; }
</style>
</head>

<body>
<div class="container">
  <h1>Atua√ß√£o Parlamentar ‚Äî Jandira Feghali (PCdoB-RJ)</h1>

  <div class="accordion">
    <div class="accordion-header" onclick="toggle(this)">
      1Ô∏è‚É£ Proposi√ß√µes apresentadas (por ano)
      <span>‚ñº</span>
    </div>
    <div class="accordion-content" id="proposicoes">
      <p>Carregando proposi√ß√µes‚Ä¶ pode demorar um pouco...</p>
    </div>
  </div>
</div>

<script>
const ANOS = [2023, 2024, 2025];
const NOME_DEPUTADA = "Jandira Feghali";
const CORS_PROXY = "https://api.allorigins.win/raw?url=";

function toggle(h) {
  const c = h.nextElementSibling;
  const a = h.querySelector("span");
  c.style.display = c.style.display === "block" ? "none" : "block";
  a.textContent = c.style.display === "block" ? "‚ñ≤" : "‚ñº";
}

async function fetchJson(url) {
  const res = await fetch(CORS_PROXY + encodeURIComponent(url));
  return await res.json();
}

async function carregarProposicoes() {
  const el = document.getElementById("proposicoes");
  let todas = [];

  for (const ano of ANOS) {
    try {
      const dataUrl = `http://dadosabertos.camara.leg.br/arquivos/proposicoes/json/proposicoes-${ano}.json`;
      const json = await fetchJson(dataUrl);
      const itens = json.proposicoes || json;
      todas = todas.concat(itens.filter(p =>
        p.autores && p.autores.some(a => a.nomeParlamentar === NOME_DEPUTADA)
      ));
    } catch (e) {
      console.warn("Erro ao baixar ou processar proposi√ß√µes do ano " + ano);
    }
  }

  if (!todas.length) {
    el.innerHTML = "<p>Nenhuma proposi√ß√£o encontrada para Jandira Feghali nos anos selecionados.</p>";
    return;
  }

  const stats = {};
  todas.forEach(p => stats[p.siglaTipo] = (stats[p.siglaTipo] || 0) + 1);

  let html = "<div class='stats'><strong>üìä Estat√≠sticas</strong><ul>";
  for (const t in stats) html += `<li>${t}: ${stats[t]}</li>`;
  html += "</ul></div>";

  html += `<p class='small'>üìå Total: ${todas.length} proposi√ß√µes</p>`;

  todas.forEach(p => {
    const relevante = ["PL","PEC","PDL"].includes(p.siglaTipo);
    html += `
      <div class="item ${relevante ? "relevante" : ""}">
        <p><span class="label">${p.siglaTipo} ${p.numero}/${p.ano}</span>
        ${relevante ? " ‚≠ê Relevante" : ""}</p>
        <p><span class="label">Ementa:</span> ${p.ementa || "‚Äî"}</p>
        <p>üîó <a href="https://www.camara.leg.br/proposicoesWeb/fichadetramitacao?idProposicao=${p.id}" target="_blank">Ver na C√¢mara</a></p>
      </div>`;
  });

  el.innerHTML = html;
}

document.addEventListener("DOMContentLoaded", carregarProposicoes);
</script>
</body>
</html>
