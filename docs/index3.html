<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Atua√ß√£o Parlamentar ‚Äì Glauber Braga</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
}
.container {
    max-width: 1000px;
    margin: auto;
}
.accordion {
    background: #fff;
    border-radius: 8px;
    margin-bottom: 15px;
    box-shadow: 0 2px 6px rgba(0,0,0,.1);
}
.accordion-header {
    padding: 15px;
    background: #1f5aa6;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
}
.accordion-content {
    display: none;
    padding: 20px;
}
.item {
    border-left: 4px solid #1f5aa6;
    padding-left: 10px;
    margin-bottom: 12px;
}
.label {
    font-weight: bold;
}
.small {
    font-size: 14px;
    color: #555;
}
</style>
</head>

<body>
<div class="container">
    <h1>Atua√ß√£o Parlamentar ‚Äì Glauber Braga (PSOL-RJ)</h1>

    <div class="accordion">
        <div class="accordion-header" onclick="toggle(this)">
            1Ô∏è‚É£ Proposi√ß√µes apresentadas
            <span>‚ñº</span>
        </div>
        <div class="accordion-content" id="proposicoes">
            <p>Carregando proposi√ß√µes...</p>
        </div>
    </div>

    <div class="accordion">
        <div class="accordion-header" onclick="toggle(this)">
            2Ô∏è‚É£ Rela√ß√£o de vota√ß√µes
            <span>‚ñº</span>
        </div>
        <div class="accordion-content" id="votacoes">
            <p>Carregando vota√ß√µes...</p>
        </div>
    </div>
</div>

<script>
const DEPUTADO_ID = 152605;
const CACHE_TTL = 86400000;

function toggle(h) {
    const c = h.nextElementSibling;
    const a = h.querySelector("span");
    c.style.display = c.style.display === "block" ? "none" : "block";
    a.textContent = c.style.display === "block" ? "‚ñ≤" : "‚ñº";
}

function cacheGet(k) {
    const v = localStorage.getItem(k);
    if (!v) return null;
    const o = JSON.parse(v);
    if (Date.now() - o.t > CACHE_TTL) return null;
    return o.d;
}

function cacheSet(k, d) {
    localStorage.setItem(k, JSON.stringify({ t: Date.now(), d }));
}

async function api(url) {
    const r = await fetch(url, {
        headers: { "Accept": "application/json" }
    });
    if (!r.ok) throw new Error("Erro API");
    return (await r.json()).dados || [];
}

// ---------------- PROPOSI√á√ïES ----------------
async function carregarProposicoes() {
    const el = document.getElementById("proposicoes");
    const cache = cacheGet("prop_glauber");
    if (cache) return renderProposicoes(cache);

    try {
        const dados = await api(
            `https://dadosabertos.camara.leg.br/api/v2/deputados/${DEPUTADO_ID}/proposicoes?ordem=DESC&ordenarPor=ano&itens=50`
        );
        cacheSet("prop_glauber", dados);
        renderProposicoes(dados);
    } catch {
        el.innerHTML = "<p>Erro ao carregar proposi√ß√µes.</p>";
    }
}

function renderProposicoes(lista) {
    const el = document.getElementById("proposicoes");
    if (!lista.length) {
        el.innerHTML = "<p>Nenhuma proposi√ß√£o encontrada.</p>";
        return;
    }
    el.innerHTML = `<p class="small">üìå ${lista.length} proposi√ß√µes encontradas</p>`;
    lista.forEach(p => {
        el.innerHTML += `
        <div class="item">
            <p><span class="label">${p.siglaTipo} ${p.numero}/${p.ano}</span></p>
            <p><span class="label">Ementa:</span> ${p.ementa || "‚Äî"}</p>
        </div>`;
    });
}

// ---------------- VOTA√á√ïES ----------------
async function carregarVotacoes() {
    const el = document.getElementById("votacoes");
    const cache = cacheGet("vot_glauber");
    if (cache) return renderVotacoes(cache);

    try {
        const dados = await api(
            `https://dadosabertos.camara.leg.br/api/v2/deputados/${DEPUTADO_ID}/votacoes?itens=50`
        );
        cacheSet("vot_glauber", dados);
        renderVotacoes(dados);
    } catch {
        el.innerHTML = "<p>Erro ao carregar vota√ß√µes.</p>";
    }
}

function renderVotacoes(lista) {
    const el = document.getElementById("votacoes");
    if (!lista.length) {
        el.innerHTML = "<p>Nenhuma vota√ß√£o nominal registrada.</p>";
        return;
    }
    el.innerHTML = `<p class="small">üìå ${lista.length} vota√ß√µes registradas</p>`;
    lista.forEach(v => {
        el.innerHTML += `
        <div class="item">
            <p><span class="label">${v.siglaTipo || "‚Äî"} ${v.numero || ""}/${v.ano || ""}</span></p>
            <p><span class="label">Voto:</span> ${v.voto || "‚Äî"}</p>
        </div>`;
    });
}

document.addEventListener("DOMContentLoaded", () => {
    carregarProposicoes();
    carregarVotacoes();
});
</script>
</body>
</html>
