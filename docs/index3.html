<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Atua√ß√£o Parlamentar ‚Äì Jandira Feghali</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
}
.container {
    max-width: 1100px;
    margin: auto;
}
h1 {
    text-align: center;
}
.accordion {
    background: #fff;
    border-radius: 8px;
    margin-bottom: 16px;
    box-shadow: 0 2px 6px rgba(0,0,0,.1);
}
.accordion-header {
    padding: 15px;
    background: #8e0038;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
}
.accordion-content {
    display: none;
    padding: 20px;
}
.item {
    border-left: 5px solid #8e0038;
    padding-left: 12px;
    margin-bottom: 14px;
}
.relevante {
    border-color: #d62828;
    background: #fff4f4;
}
.stats {
    background: #fdecef;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 15px;
}
.small {
    font-size: 14px;
    color: #555;
}
.label {
    font-weight: bold;
}
a {
    color: #8e0038;
    text-decoration: none;
}
</style>
</head>

<body>
<div class="container">
    <h1>Atua√ß√£o Parlamentar ‚Äì Jandira Feghali (PCdoB-RJ)</h1>

    <div class="accordion">
        <div class="accordion-header" onclick="toggle(this)">
            1Ô∏è‚É£ Proposi√ß√µes apresentadas
            <span>‚ñº</span>
        </div>
        <div class="accordion-content" id="proposicoes">
            <p>Carregando proposi√ß√µes‚Ä¶</p>
        </div>
    </div>
</div>

<script>
const NOME_AUTOR = "Jandira Feghali";
const ANO_INICIAL = 2023;
const CORS_PROXY = "https://api.allorigins.win/raw?url=";

function toggle(h) {
    const c = h.nextElementSibling;
    const a = h.querySelector("span");
    c.style.display = c.style.display === "block" ? "none" : "block";
    a.textContent = c.style.display === "block" ? "‚ñ≤" : "‚ñº";
}

async function api(url) {
    const res = await fetch(CORS_PROXY + encodeURIComponent(url));
    const json = await res.json();
    return json.dados || [];
}

async function carregarProposicoes() {
    const el = document.getElementById("proposicoes");

    try {
        let pagina = 1;
        let todas = [];

        while (true) {
            const dados = await api(
                `https://dadosabertos.camara.leg.br/api/v2/proposicoes` +
                `?autor=${encodeURIComponent(NOME_AUTOR)}` +
                `&itens=50&pagina=${pagina}&ordem=DESC&ordenarPor=ano`
            );

            if (!dados.length) break;
            todas = todas.concat(dados);
            pagina++;
        }

        const filtradas = todas.filter(p => p.ano >= ANO_INICIAL);

        if (!filtradas.length) {
            el.innerHTML = "<p>Nenhuma proposi√ß√£o encontrada.</p>";
            return;
        }

        const stats = {};
        filtradas.forEach(p => {
            stats[p.siglaTipo] = (stats[p.siglaTipo] || 0) + 1;
        });

        let html = "<div class='stats'><strong>üìä Estat√≠sticas</strong><ul>";
        for (const t in stats) {
            html += `<li>${t}: ${stats[t]}</li>`;
        }
        html += "</ul></div>";
        html += `<p class="small">üìå Total: ${filtradas.length} proposi√ß√µes desde 2023</p>`;

        filtradas.forEach(p => {
            const relevante = ["PL","PEC","PDL"].includes(p.siglaTipo);
            html += `
            <div class="item ${relevante ? "relevante" : ""}">
                <p>
                    <span class="label">${p.siglaTipo} ${p.numero}/${p.ano}</span>
                    ${relevante ? " ‚≠ê Relevante" : ""}
                </p>
                <p><span class="label">Ementa:</span> ${p.ementa || "‚Äî"}</p>
                <p>üîó <a href="${p.uri}" target="_blank">Ver na C√¢mara</a></p>
            </div>`;
        });

        el.innerHTML = html;

    } catch (e) {
        el.innerHTML = "<p>Erro ao carregar proposi√ß√µes.</p>";
        console.error(e);
    }
}

document.addEventListener("DOMContentLoaded", carregarProposicoes);
</script>
</body>
</html>
